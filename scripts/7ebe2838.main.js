var gestureLine={};gestureLine.ns=function(a){"use strict";for(var b,c=a.split("."),d=window,e=0,f=c.length;f>e;e++)b=c[e],d[b]=d[b]||{},d=d[b];return d};var gestureLine=gestureLine||{};gestureLine.gesturePoint=function(){"use strict";var a=function(a,b){a&&b?(this.x=a,this.y=b):(this.x=0,this.y=0)},b=a.prototype;return b.setPos=function(a,b){this.x=a,this.y=b},a}();var gestureLine=gestureLine||{};gestureLine.anglePoint=function(){"use strict";var a=function(a){a?this.angle=a:this.angle=0},b=a.prototype;return b.setAngle=function(a){this.angle=a},a}();var gestureLine=gestureLine||{};gestureLine.pointRecorder=function(){"use strict";var a=function(a){this.nPoints=a,this.isResampled=!1,this.geometry=new THREE.Geometry,this.geometry.dynamic=!0,this.shaderAttrs={aPosition:{type:"v3",value:[]}},this.shaderUniforms={amplitude:{type:"f",value:1},opacity:{type:"f",value:1},color:{type:"c",value:new THREE.Color(0)}},this.material=new THREE.ShaderMaterial({uniforms:this.shaderUniforms,attributes:this.shaderAttrs,vertexShader:document.getElementById("vertexshader").textContent,fragmentShader:document.getElementById("fragmentshader").textContent,depthTest:!1}),this.pos=[];for(var b=this.shaderAttrs.aPosition.value,c=0;c<this.nPoints;c++)this.geometry.vertices.push(new THREE.Vector3(0,0,1)),b[c]=new THREE.Vector3(0,0,0),this.pos[c]=b[c];this.clear(),this.pointCounter=0,this.mesh=new THREE.Line(this.geometry,this.material)},b=a.prototype;return b.addPoint=function(a,b){if(this.pointCounter<this.nPoints){var c=this.pointCounter%this.nPoints;this.pos[c]=new THREE.Vector2(a,b),this.pointCounter++}},b.draw=function(a){if(a&&this.pointCounter>100)for(var b=gestureLine.main.getCanvasSize(),c=0;c<this.pos.length;c++)this.shaderAttrs.aPosition.value[c]=new THREE.Vector3(b.x/2-this.pos[c].x,b.y/2-this.pos[c].y,0);else for(var d=0;d<this.nPoints;d++)this.shaderAttrs.aPosition.value[d]=new THREE.Vector3(0,0,-1);this.shaderAttrs.aPosition.needsUpdate=!0},b.copy=function(){var a={};return a.pointCounter=this.pointCounter,a.pos=this.pos,a},b.clear=function(){this.pointCounter=0,this.curve=null},b.calculateLength=function(){if(this.nPoints<2)return 0;for(var a,b,c=0,d=1;d<this.pointCounter;d++)a=this.pos[d].x-this.pos[d-1].x,b=this.pos[d].y-this.pos[d-1].y,c+=Math.sqrt(a*a+b*b);return c},b.resampleIntoMe=function(a,b){var c,d,e=b,f=a.pointCounter,g=f,h=a.calculateLength();0===h&&(h=1e-4);var i,j,k,l,m,n,o,p,q,r,s,t,u,v,w=0,x=h/(e-1),y=x,z=0,A=0,B=1e-4;if(1>=g)for(z=0;e>z;z++)c=a.pos[0],m=c.x+z*B,n=c.y+z*B,this.pos[A].x=m,this.pos[A].y=n,A++;else{for(u=0;g-1>u;u++)if(c=a.pos[u],d=a.pos[u+1],i=d.x-c.x,j=d.y-c.y,0===i&&0===j&&(i=B,j=B),q=Math.sqrt(i*i+j*j),r=q,k=i/q,l=j/q,o=k*x,p=l*x,t=x-y,r>=t){s=r,m=c.x+t*k,n=c.y+t*l,e-1>z?(this.pos[A].x=m,this.pos[A].y=n,A++,w+=x,s-=t,z++):console.log("This line is comes out whenever p is bigger than resampled points"),v=s/x;for(var C=0;v>C;C++)m+=o,n+=p,e-1>z&&(this.pos[A].x=m,this.pos[A].y=n,A++,w+=x,s-=x,z++);y=s}else y+=r;for(d=a.pos[f-1];b>A;)this.pos[A].x=d.x,this.pos[A].y=d.y,A++}this.pointCounter=A},a}();var gestureLine=gestureLine||{};gestureLine.angleLengthLine=function(){"use strict";var a=function(a){this.nPoints=a,this.gesturePoints=[],this.anglePoints=[];for(var b=0;b<this.nPoints;b++)this.gesturePoints[b]=new gestureLine.gesturePoint(0,0),this.anglePoints[b]=new gestureLine.anglePoint(0);this.pointCounter=0},b=a.prototype;return b.convertFromAngleLengthLine=function(a,b){var c,d,e;d=0,b||(b=0),this.pointCounter=a.pointCounter-2;for(var f=2;f<a.pointCounter;f++){var g=a.pos[f-1],h=a.pos[f];if(2===f)d=Math.PI/2;else{c=Math.PI-this.returnAngle(g,h),e=c-d,e>=Math.PI?e=-(d+(2*Math.PI-c)):e<-Math.PI&&(e=c+(2*Math.PI-d));var i=f-2+b;this.anglePoints[i].setAngle(e),d=c}}},b.returnAngle=function(a,b){return Math.atan2(b.x-a.x,b.y-a.y)},b.draw=function(a,b,c,d,e,f){var g,h;g=new gestureLine.gesturePoint(0,0),h=new gestureLine.gesturePoint(0,0),g.x=c,g.y=d;var i=b,j=e;a.beginPath();for(var k=f;k<this.pointCounter-24;k++)j+=this.anglePoints[k].angle,h.x=g.x-i*Math.cos(j),h.y=g.y-i*Math.sin(j),a.moveTo(g.x,g.y),a.lineTo(h.x,h.y),g.x=h.x,g.y=h.y;a.stroke()},a}();var gestureLine=gestureLine||{};gestureLine.angleLengthLineMorpher=function(){"use strict";var a=function(a,b,c){this.numPoints=a,this.anglePtsPresents=[],this.anglePtsTargets=[],this.anglePtsDiffs=[],this.pts=[],this.rightUpControlPts=[],this.rightDownControlPts=[],this.leftUpControlPts=[],this.leftDownControlPts=[],this.centroid=new THREE.Vector3,this.centroidOffsetCatch=new THREE.Vector3;for(var d=0;d<this.numPoints;d++)this.anglePtsPresents[d]=new gestureLine.anglePoint,this.anglePtsTargets[d]=new gestureLine.anglePoint,this.anglePtsDiffs[d]=new gestureLine.anglePoint,this.pts[d]=new THREE.Vector3,this.rightUpControlPts[d]=new THREE.Vector3,this.rightDownControlPts[d]=new THREE.Vector3,this.leftUpControlPts[d]=new THREE.Vector3,this.leftDownControlPts[d]=new THREE.Vector3;this.gp0=new THREE.Vector3,this.gp1=new THREE.Vector3,this.p0=new THREE.Vector3,this.p1=new THREE.Vector3,this.pOrig=new THREE.Vector3,this.gp0.x=b,this.gp0.y=c,this.lineLength=1.1,this.angleTotalBack=0,this.angleTotalForw=0,this.firstCall=!0,this.mesh,this.shaderAttr,this.shaderUniform;var e=document.getElementById("vertexshader").textContent,f=document.getElementById("fragmentshader").textContent,g=new THREE.Geometry;g.dynamic=!0;for(var h={aPosition:{type:"v3",value:[]}},i={amplitude:{type:"f",value:1},opacity:{type:"f",value:.3},color:{type:"c",value:new THREE.Color(16777215)},iGlobalTime:{type:"f",value:0}},j=new THREE.ShaderMaterial({uniforms:i,attributes:h,vertexShader:e,fragmentShader:f,depthTest:!1}),k=0;k<this.numPoints-2;k++)g.vertices.push(new THREE.Vector3(0,0,1)),h.aPosition.value[k]=new THREE.Vector3(0,0,1);this.mesh=new THREE.Line(g,j),this.shaderAttr=h,this.shaderUniform=i,this.clear()},b=a.prototype;return b.clear=function(){this.ptCount=0,this.totalTimeMillis=1500,this.startTimeMillis=0,this.bAmAnimating=!1,this.ptcAnimating=0},b.setPresents=function(a){for(var b=0;b<this.numPoints;b++)this.anglePtsPresents[b].angle=a[b].angle},b.setTargets=function(a){this.startTimeMillis=gestureLine.main.millis(),this.bAmAnimating=!0;var b=0;this.anglePtsPresents=this.anglePtsTargets.slice(),this.anglePtsTargets=a.anglePoints.slice();for(var c=0;c<this.numPoints;c++)this.anglePtsDiffs[c].angle=this.anglePtsTargets[c].angle-this.anglePtsPresents[c].angle,b+=Math.abs(this.anglePtsDiffs[c].angle);this.totalTimeMillis=Math.max(35*b,750),this.ptCount=this.numPoints-2},b.draw=function(a,b){this.bAmAnimating&&(gestureLine.main.millis()-this.startTimeMillis<this.totalTimeMillis?this.ptcAnimating=(gestureLine.main.millis()-this.startTimeMillis)/this.totalTimeMillis:(this.bAmAnimating=!1,this.anglePtsPresents=this.anglePtsTargets.slice()));var c=.5-.5*Math.cos(this.ptcAnimating*Math.PI);(this.bAmAnimating===!0||this.firstCall===!0)&&(this.calcForward(c),this.calcCentroid(a,b)),this.drawPoints(),this.firstCall=!1},b.calcForward=function(a){this.p0.x=.95*this.gp0.x+10,this.p0.y=.95*this.gp0.y+9,this.pOrig.x=this.p0.x,this.pOrig.y=this.p0.y;for(var b,c,d,e=0,f=0;f<this.ptCount;f++)b=this.anglePtsPresents[f].angle,c=a*this.anglePtsDiffs[f].angle,d=b+c,d>Math.PI&&(d-=2*Math.PI),d<Math.PI&&(d+=2*Math.PI),e+=d,this.p1.x=this.p0.x+this.lineLength*Math.cos(e),this.p1.y=this.p0.y+this.lineLength*Math.sin(e),this.pts[f].x=.95*this.pts[f].x+.05*this.p1.x,this.pts[f].y=.95*this.pts[f].y+.05*this.p1.y,this.p0.set(this.p1.x,this.p1.y,1);this.gp1.set(this.p1.x,this.p1.y,1),this.angleTotalBack=Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)},b.calcCentroid=function(a,b){if(!(this.ptCount<=0)){for(var c=0;c<this.ptCount;c++)this.centroid.x+=this.pts[c].x,this.centroid.y+=this.pts[c].y;this.centroid.x/=this.ptCount,this.centroid.y/=this.ptCount,this.centroidOffsetCatch.x=.1*this.centroidOffsetCatch.x+.9*this.centroid.x,this.centroidOffsetCatch.y=.1*this.centroidOffsetCatch.y+.9*this.centroid.y;for(var d=b-this.centroidOffsetCatch.y,e=a-this.centroidOffsetCatch.x,f=0;f<this.ptCount;f++)this.pts[f].y+=d,this.pts[f].x+=e}},b.drawPoints=function(){if(!(this.ptCount<=0)){for(var a=this.shaderAttr,b=0;b<this.ptCount;b++)a.aPosition.value[b].set(-this.pts[b].x,-this.pts[b].y,1);a.aPosition.needsUpdate=!0}},a}();var gestureLine=gestureLine||{};gestureLine.main=function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t=[],u=0,v="http://172.16.0.194:5111/";return{init:function(){a=this,j=new Faye.Client(v),j.subscribe("/messages",function(a){gestureLine.main.onMessageRecieved(a)}),h=new Date,i=Date.now(),f=250,c=new gestureLine.pointRecorder(4*f),b=new gestureLine.pointRecorder(f),d=new gestureLine.angleLengthLine(f),e=new gestureLine.angleLengthLineMorpher(f,100,100),k=window.innerWidth,l=window.innerHeight,m=new THREE.Vector2(k,l),n=document.createElement("div"),document.body.appendChild(n),o=new THREE.OrthographicCamera(k/-2,k/2,l/2,l/-2,.1,1e3),p=new THREE.Scene,p.add(o),o.position.set(0,0,-240),o.lookAt(p.position),q=new THREE.WebGLRenderer({antialias:!0}),q.setClearColor(15658734),q.setPixelRatio(window.devicePixelRatio),q.setSize(k,l),n.appendChild(q.domElement),r=document.getElementById("vertexshader").textContent,s=document.getElementById("fragmentshader").textContent,g=!1,n.addEventListener("mousedown",gestureLine.main.onMouseDown,!1),n.addEventListener("touchstart",gestureLine.main.onMouseDown,!1),n.addEventListener("mouseup",gestureLine.main.onMouseUp,!1),n.addEventListener("touchend",gestureLine.main.onMouseUp,!1),n.addEventListener("mousemove",function(a){gestureLine.main.onMouseMove(n,a)},!1),n.addEventListener("touchmove",function(a){gestureLine.main.onTouchMove(n,a)},!1),n.addEventListener("mouseout",gestureLine.main.onMouseOut,!1),window.addEventListener("resize",gestureLine.main.onWindowResize,!1),gestureLine.main.setDrawing(b),b.clear(),c.clear(),p.add(b.mesh),p.add(e.mesh),a.draw()},draw:function(){requestAnimationFrame(a.draw),t.length>0&&gestureLine.main.ticker(),e.draw(0,0),b.draw(g),q.render(p,o)},onWindowResize:function(){k=window.innerWidth,l=window.innerHeight,o.left=-k/2,o.right=k/2,o.top=l/2,o.bottom=-l/2,o.updateProjectionMatrix(),q.setSize(k,l),m=new THREE.Vector2(k,l)},drawNext:function(){if(u===t.length&&(u=0),t.length>0){var a=t[u];gestureLine.main.setDrawing(a),u++}},setDrawing:function(a){d.convertFromAngleLengthLine(a),e.setTargets(d)},ticker:function(){var a=Date.now();a-i>=1500&&(i=a,gestureLine.main.drawNext())},onTouchMove:function(a,b){if(b.preventDefault(),g){var c=a.getBoundingClientRect(),d=b.targetTouches[0].pageX-c.left,e=b.targetTouches[0].pageY-c.top;gestureLine.main.recordPoint(d,e)}},onMouseMove:function(a,b){if(g){var c=a.getBoundingClientRect(),d=b.clientX-c.left,e=b.clientY-c.top;gestureLine.main.recordPoint(d,e)}},recordPoint:function(a,d){c.addPoint(a,d),c.pointCounter>4&&b.resampleIntoMe(c,f)},onMouseDown:function(){g=!0},onMouseUp:function(){g&&gestureLine.main.sendPoints(),g=!1},onMouseOut:function(){g&&gestureLine.main.sendPoints(),g=!1},sendPoints:function(){var a={};a.pointCounter=b.nPoints-1,a.pos=b.pos;var d=JSON.stringify(a);j.publish("/messages",{text:d}),c.clear(),b.clear()},onMessageRecieved:function(a){var b=JSON.parse(a.text);t.push(b)},millis:function(){return h.getTime()},getCanvasSize:function(){return m}}}(),document.addEventListener("DOMContentLoaded",function(){"use strict";gestureLine.main.init()});